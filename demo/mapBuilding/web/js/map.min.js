function ocultarLayer(e){var t=map.getLayersByName(e)[0];if(t.getVisibility()){t.setVisibility(false)}else{t.setVisibility(true)}}function buscarLayer(e,t){var n=map.getLayersByName(e)[0];n.setVisibility(t)}function agregarRutas(){$.each(rutasByID,function(e,t){var n=[];var r=new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT(t.geom));var i=new OpenLayers.Layer.Vector(t.nombre,{displayInLayerSwitcher:false,styleMap:new OpenLayers.StyleMap({fillColor:t.color,strokeColor:t.color,strokeDashstyle:"dash",cursor:"pointer"})});var s=r.geometry.components.length;var o=r.geometry.components[0];var u=r.geometry.components[1];var a={x:(o.x+u.x)/2,y:(o.y+u.y)/2};n=recorrerLineString(r.geometry.components,t.color,t.nombre,n);n.push(r);map.addLayer(i);i.addFeatures(n)})}function agregarParadas(){layer_paradas=[];$.each(paradasByID,function(e,t){var n=new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT(t.geom));var r=new OpenLayers.Layer.Vector(t.nombre,{displayInLayerSwitcher:false,styleMap:new OpenLayers.StyleMap({pointRadius:17,externalGraphic:t.icono,cursor:"pointer"}),eventListeners:{featureselected:function(e){var n=e.feature;OpenLayers.Popup.FramedCloud.prototype.autoSize=true;OpenLayers.Popup.FramedCloud.prototype.relativePosition="cm";var r=new OpenLayers.Popup.FramedCloud("popup",OpenLayers.LonLat.fromString(n.geometry.toShortString()),null,"<div style='font-size:.8em'><center><strong>"+t.nombre+"</strong></center><br><strong>Direccion: </strong>"+t.direccion+"<br><strong>info: </strong>"+t.info_adicional+"<br>"+t.descripcion+"</div>",null,true);n.popup=r;map.addPopup(r)},featureunselected:function(e){var t=e.feature;map.removePopup(t.popup);t.popup.destroy();t.popup=null}}});layer_paradas.push(r);var i=n.geometry.getCentroid();var s=agregarLabel(t.nombre,"rt",i.x,i.y,"#1f8eb9");map.addLayer(r);r.addFeatures([n,s])});addSelectControl()}function agregarLabel(e,t,n,r,i){var s=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(n,r),{},{label:e,fontColor:i,fontSize:"11px",fontFamily:"Arial",fontWeight:"bold",labelAlign:t,labelOutlineColor:"white",labelOutlineWidth:3});return s}function agregarTriangulo(e,t,n,r){var i=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t,n),{},{strokeColor:e,fillColor:e,srokeWidth:2,strokeOpacity:.8,pointRadius:3,graphicName:"triangle",rotation:r});return i}function recorrerLineString(e,t,n,r){var i;var s="";$.each(e,function(e,o){if(i!=null){s=getAngleofLine(i,o);var u={x:(i.x+o.x)/2,y:(i.y+o.y)/2};var a=agregarTriangulo(t,u.x,u.y,s);if(e%3==0){var f=agregarLabel(n,"cm",u.x,u.y,"#000");r.push(f)}r.push(a)}i=o});return r}function addSelectControl(){selectControl=new OpenLayers.Control.SelectFeature(layer_paradas,{click:true,autoActivate:true});map.addControl(selectControl);selectControl.activate()}function getAngleofLine(e,t){b_x=0;b_y=1;a_x=t.x-e.x;a_y=t.y-e.y;angle_rad=Math.acos((a_x*b_x+a_y*b_y)/Math.sqrt(a_x*a_x+a_y*a_y));angle=360/(2*Math.PI)*angle_rad;if(a_x<0){return 360-angle}else{return angle}}var map,rutasByID,paradasByID,layer_paradas,selectControl;var apiKey="AqTGBsziZHIJYYxgivLBf0hVdrAk9mWO5cQcb8Yux8sW5M8c8opEC2lZqKR1ZZXf";var ruta_path_icon="web/images/marker/default.png";var gg=new OpenLayers.Projection("EPSG:4326");var sm=new OpenLayers.Projection("EPSG:900913");$(document).ready(function(){OpenLayers.Lang.setCode("en");map=new OpenLayers.Map({div:"map_canvas",projection:sm,numZoomLevels:18,layers:[new OpenLayers.Layer.OSM("OpenStreetMap",null,{transitionEffect:"resize"}),new OpenLayers.Layer.Google("Google Physical",{type:google.maps.MapTypeId.TERRAIN}),new OpenLayers.Layer.Google("Google Streets",{numZoomLevels:18}),new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.HYBRID,numZoomLevels:18}),new OpenLayers.Layer.Google("Google Satellite",{type:google.maps.MapTypeId.SATELLITE,numZoomLevels:18}),new OpenLayers.Layer.Bing({name:"Bing Road",key:apiKey,type:"Road"}),new OpenLayers.Layer.Bing({name:"bing Hybrid",key:apiKey,type:"AerialWithLabels"}),new OpenLayers.Layer.Bing({name:"Bing Aerial",key:apiKey,type:"Aerial"})],center:new OpenLayers.LonLat(-8894255.605853265,-237997.43648986897),zoom:15});map.addControl(new OpenLayers.Control.LayerSwitcher);map.addControl(new OpenLayers.Control.MousePosition);map.addControl(new OpenLayers.Control.ScaleLine)})